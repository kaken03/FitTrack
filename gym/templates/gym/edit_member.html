<!DOCTYPE html>
<html>
<head>
    <title>Edit Member</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'gym/edit_add_member.css' %}">
</head>
<body>
    <div class="container">
        <a href="{% url 'home' %}" class="btn btn-primary">← Back</a>
        <h1>Edit Member</h1>
        <form method="POST">
            {% csrf_token %}
            <label>Name:</label>
            <input type="text" name="name" value="{{ member.name }}" required>

            <label>Email:</label>
            <input type="email" name="email" value="{{ member.email }}" required>

            <label for="plan">Select Plan:</label>
            <select name="plan" id="plan" required>
                <option value="" disabled>-- Choose a Plan --</option>
                {% for plan in plans %}
                    <option value="{{ plan.id }}" data-months="{{ plan.duration_months }}" {% if member.plan.id == plan.id %}selected{% endif %}>
                        {{ plan.name }} — ₱{{ plan.price }} ({{ plan.duration_months }} Month{% if plan.duration_months > 1 %}s{% endif %})
                    </option>
                {% endfor %}
            </select>

            <label>Start Date:</label>
            <input type="date" name="start_date" id="start_date" value="{{ member.start_date }}" required>

            <label>Expiry Date:</label>
            <input type="date" name="expiry_date" id="expiry_date" value="{{ member.expiry_date }}" required>

            <button type="submit">Save Changes</button>
        </form>
        
    </div>

    <script>
        const planSelect = document.getElementById('plan');
        const startDateInput = document.getElementById('start_date');
        const expiryDateInput = document.getElementById('expiry_date');

        function calculateExpiry() {
            const startDate = new Date(startDateInput.value);
            const selectedOption = planSelect.options[planSelect.selectedIndex];
            
            // Get duration_months from the data attribute
            const monthsToAdd = parseInt(selectedOption.getAttribute('data-months'));

            if (!isNaN(startDate.getTime()) && monthsToAdd) {
                // Add months
                startDate.setMonth(startDate.getMonth() + monthsToAdd);
                
                // Format back to YYYY-MM-DD
                expiryDateInput.value = startDate.toISOString().split('T')[0];
            }
        }

        // Initialize on page load
        window.onload = function() {
            calculateExpiry();
        };

        // Run calculation whenever Plan or Start Date changes
        planSelect.addEventListener('change', calculateExpiry);
        startDateInput.addEventListener('change', calculateExpiry);
    </script>
</body>
</html>
